# Run these commands on your server to fix the consultation API

# Step 1: Check current .env file
cd ~/tool-thinker
cat .env

# Step 2: Edit .env file and replace the placeholder
nano .env

# In nano, find the line:
# OPENAI_API_KEY=your_openai_key_here
# 
# Replace it with your actual OpenAI API key:
# OPENAI_API_KEY=sk-your-actual-key-here
#
# Save: Ctrl+X, then Y, then Enter

# Step 3: Verify the key is set (should NOT show "your_openai_key_here")
cat .env | grep OPENAI_API_KEY

# Step 4: Restart PM2 to load new environment variables
pm2 restart tool-thinker

# Step 5: Wait a few seconds for app to start
sleep 3

# Step 6: Test the API endpoint
curl -X POST http://localhost:3000/api/consultation/chat \
  -H "Content-Type: application/json" \
  -d '{"messages":[{"role":"user","content":"Hello, test message"}]}'

# If you see a JSON response with "response" field, it's working!
# If you see an error, check PM2 logs:
pm2 logs tool-thinker --err --lines 20

