# Copy and paste these commands on your server (SSH)

cd ~/tool-thinker

# ============================================
# OPTION 1: Pull from GitHub (if you pushed)
# ============================================
git pull origin main
npm run build
pm2 restart tool-thinker

# ============================================
# OPTION 2: Manual Fix (if git pull doesn't work)
# ============================================

# Step 1: Update book URL
sed -i 's|https://www.amazon.com/dp/YOUR_BOOK_ISBN|https://www.amazon.com/START-SMART-Entrepreneurs-Frameworks-need/dp/1300734477|g' app/page.tsx

# Step 2: Fix Navigation.tsx - Update import
sed -i 's/import { useState } from "react"/import { useState, useEffect } from "react"/' components/Navigation.tsx

# Step 3: Add useEffect and handleLinkClick after pathname line
# First, let's create a backup
cp components/Navigation.tsx components/Navigation.tsx.backup

# Now we need to add the useEffect and handleLinkClick
# This is complex with sed, so we'll use a here-document approach
cat > /tmp/nav_fix.txt << 'NAVEOF'
  
  // Close menu when route changes and scroll to top
  useEffect(() => {
    setIsMenuOpen(false)
    // Scroll to top on route change
    window.scrollTo({ top: 0, behavior: 'instant' })
  }, [pathname])
  
  // Helper function to handle link clicks
  const handleLinkClick = () => {
    setIsMenuOpen(false)
    // Scroll to top immediately
    window.scrollTo({ top: 0, behavior: 'instant' })
  }
NAVEOF

# Insert after pathname line
sed -i '/const pathname = usePathname()/r /tmp/nav_fix.txt' components/Navigation.tsx

# Step 4: Replace mobile menu onClick handlers
sed -i 's/onClick={() => setIsMenuOpen(false)}/onClick={handleLinkClick}/g' components/Navigation.tsx

# Step 5: Add scroll-to-top to desktop Home link
sed -i 's|<Link href="/" className=|<Link href="/" onClick={() => window.scrollTo({ top: 0, behavior: '\''instant'\'' })} className=|' components/Navigation.tsx

# Step 6: Add scroll-to-top to desktop Blogs link
sed -i 's|<Link href="/blogs" className=|<Link href="/blogs" onClick={() => window.scrollTo({ top: 0, behavior: '\''instant'\'' })} className=|' components/Navigation.tsx

# Step 7: Add scroll-to-top to desktop About link
sed -i 's|<Link href="/about" className=|<Link href="/about" onClick={() => window.scrollTo({ top: 0, behavior: '\''instant'\'' })} className=|' components/Navigation.tsx

# Step 8: Add scroll-to-top to desktop dropdown links (more complex, need to be careful)
sed -i 's|<Link href="/tools" onClick={() => window.scrollTo({ top: 0, behavior: '\''instant'\'' })} className=|&|' components/Navigation.tsx || \
sed -i '/href="\/tools"/{ /onClick/! { s/<Link href="\/tools"/<Link href="\/tools" onClick={() => window.scrollTo({ top: 0, behavior: '\''instant'\'' })}/ } }' components/Navigation.tsx

# For dropdown links, we need to add onClick to each one
# This is getting complex - better to use a Python script or manually edit

# Step 9: Rebuild
npm run build
pm2 restart tool-thinker
